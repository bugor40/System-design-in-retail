# ML System Design (HSE retail course)

## 1. Цели и предпосылки
### 1.1 Зачем нужно идти в разработку продукта
**Бизнес-цель** - оптимизация текущих процессов распределения курьеров между зонами доставки для:
- сокращения времени доставки в высоконагруженных зонах, а также в часы пик.

**Побочная цель** - оптимизация людских ресурсов и затрат на них в малозагруженных зонах.

**Текущий бизнес процесс**
В каждом городе есть в среднем 30 дарксторов. К каждому даркстору привязаны зоны, которые не пересекаются между собой. Каждый даркстор осуществляет доставку по двум типов заказов:
- быстрые (в течение 60 мин. с момента завершения заказа)
- доставка к конкретному времени (заранее указывается желаемый часовой слот доставки)

> *предположим*, что...

На данный момент распределение курьеров на зоны происходит на базе экспертной оценки менеджеров (т.е за каждой зоной города закрепляется какое-то кол-во курьеров, которое сможет обеспечить доставку заказов в каждой из зон).

**Польза от внедрения ML**
Внедрение ML модели сократит время доставки заказов и оптимизирует затраты на содержание персонала (курьеров), а  также избавит от ручных расчётов необходимого количества курьеров.

**Бизнес-критерии успеха:**
- сокращение среднего времени доставки (t) после внедрения модели
- сокращение необходимого количества курьеров

**Критерии успеха в терминах ML:**
Скорость доставки напрямую зависит от двух факторов:
1) Как быстро курьер сможет освободиться и забрать заказ
2) На сколько большая зона закреплённая за даркстором 

> для упрощения примем, что все зоны +- одинаковы по площади, и среднее время доставки от момента получения заказа курьером в каждой из зон тоже одинаковое

Учитывая допущения выше, можно сказать, что скорость доставки заказа от момента заказа до получения этого заказа клиентом зависит только от количества курьеров и количества заказов в данной зоне.

Таким образом ML модель должна давать прогноз заказов в конкретной зоне с точностью ≥ экспертной оценки менеджеров, но не менее 85%
$$WAPPE_{модель}≥WAPPE_{менеджер}$$

WAPPE - метрика взвешенной процентной ошибки. Ключевым отличием от WAPE является то, что процент ошибки считается не от фактического значения, а от предсказанного. Такой приём позволяет чаще преувеличить прогноз, чем занизить его при прямой оптимизации этой метрики при обучении.

$$WAPPE={\frac{{\displaystyle\sum_{i=1}^{N}|y_{true}}-y_{pred}|}{\displaystyle\sum_{i=1}^{N}|y_{pred}|}},$$

$N$ – 

$\hat{y}_{true}$ – истинное значение 

$y_{pred}$ – предсказанное значение 
